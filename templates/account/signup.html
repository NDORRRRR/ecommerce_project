{% extends "base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load widget_tweaks %} {# <-- WAJIB: Load library-nya #}

{% block head_title %}{% trans "Daftar Akun Baru" %}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
        <div class="card shadow-sm">
            <div class="card-header text-center bg-light">
                <h4 class="mb-0">{% trans "Buat Akun Baru" %}</h4>
            </div>
            <div class="card-body">
                <p class="text-center text-muted small">{% blocktrans %}Sudah punya akun? Silakan <a href="{{ login_url }}">masuk</a>.{% endblocktrans %}</p>

                <form class="signup" id="signup_form" method="post" action="{% url 'account_signup' %}">
                    {% csrf_token %}

                    {{ form.email|as_crispy_field }}
                    {{ form.nama|as_crispy_field }}
                    {{ form.noHP|as_crispy_field }}
                    {{ form.alamat|as_crispy_field }}

                    <div class="mb-3">
                        <label for="id_password1" class="form-label requiredField">Sandi<span class="asteriskField">*</span></label>
                        <div class="password-wrapper">
                            {% render_field form.password1 class+="form-control" placeholder="Buat sandi" %}
                            <span class="password-toggle-icon" id="togglePassword1">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <div class="form-text text-muted">{{ form.password1.help_text|safe }}</div>
                        {% if form.password1.errors %}{% for error in form.password1.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}{% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="id_password2" class="form-label requiredField">Konfirmasi Sandi<span class="asteriskField">*</span></label>
                        <div class="password-wrapper">
                            {% render_field form.password2 class+="form-control" placeholder="Ketik ulang sandi" %}
                            <span class="password-toggle-icon" id="togglePassword2">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        {% if form.password2.errors %}{% for error in form.password2.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}{% endif %}
                    </div>
                    
                    <div class="d-grid mt-4">
                        <button class="btn btn-primary" type="submit">{% trans "Daftar" %}</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<style>
.password-wrapper {
    position: relative;
}
.password-toggle-icon {
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    cursor: pointer;
    color: #6c757d;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    function setupPasswordToggle(inputId, toggleId) {
        const passwordInput = document.getElementById(inputId);
        const toggleButton = document.getElementById(toggleId);
        if (toggleButton && passwordInput) {
            const icon = toggleButton.querySelector('i');
            toggleButton.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                icon.classList.toggle('fa-eye');
                icon.classList.toggle('fa-eye-slash');
            });
        }
    }
    setupPasswordToggle('id_password1', 'togglePassword1');
    setupPasswordToggle('id_password2', 'togglePassword2');
});
</script>
{% endblock %}