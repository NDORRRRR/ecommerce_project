{% extends 'base.html' %}

{% block title %}Kelola Pengiriman - Admin{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-shipping-fast"></i> Kelola Pengiriman</h2>
    <div>
        <!-- Filter Buttons -->
        <div class="btn-group" role="group">
            <a href="?status=pending" class="btn btn-outline-secondary {% if selected_status == 'pending' %}active{% endif %}">
                Pending
            </a>
            <a href="?status=processing" class="btn btn-outline-warning {% if selected_status == 'processing' %}active{% endif %}">
                Processing
            </a>
            <a href="?status=shipped" class="btn btn-outline-info {% if selected_status == 'shipped' %}active{% endif %}">
                Shipped
            </a>
            <a href="?status=delivered" class="btn btn-outline-success {% if selected_status == 'delivered' %}active{% endif %}">
                Delivered
            </a>
            <a href="{% url 'kelola_pengiriman' %}" class="btn btn-outline-primary">
                Semua
            </a>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card border-secondary">
            <div class="card-body text-center">
                <h5 class="card-title">Pending</h5>
                <h2 class="text-secondary">
                    {{ status_counts.pending|default:"0" }}
                </h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-warning">
            <div class="card-body text-center">
                <h5 class="card-title">Processing</h5>
                <h2 class="text-warning">
                    {{ status_counts.processing|default:"0" }}
                </h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-info">
            <div class="card-body text-center">
                <h5 class="card-title">Shipped</h5>
                <h2 class="text-info">
                    {{ status_counts.shipped|default:"0" }}
                </h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-success">
            <div class="card-body text-center">
                <h5 class="card-title">Delivered</h5>
                <h2 class="text-success">
                    {{ status_counts.delivered|default:"0" }}
                </h2>
            </div>
        </div>
    </div>
</div>

<!-- Main Table -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>No. Resi</th>
                        <th>Ekspedisi</th>
                        <th>Alamat Tujuan</th>
                        <th>Ongkir</th>
                        <th>Status</th>
                        <th>Tanggal</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pengiriman in pengiriman_list %}
                        <tr>
                            <td>#{{ pengiriman.id }}</td>
                            <td>
                                {% if pengiriman.no_resi %}
                                    <code>{{ pengiriman.no_resi }}</code>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge bg-primary">{{ pengiriman.get_ekspedisi_display }}</span>
                            </td>
                            <td>
                                <span title="{{ pengiriman.alamat_penerima }}">
                                    {{ pengiriman.alamat_penerima|truncatechars:30 }}
                                </span>
                            </td>
                            <td>Rp {{ pengiriman.ongkir|floatformat:0 }}</td>
                            <td>
                                <span class="badge bg-{{ pengiriman.get_status_badge_color }}">
                                    {{ pengiriman.tampilkanstatus }}
                                </span>
                            </td>
                            <td>{{ pengiriman.created_at|date:"d M Y H:i" }}</td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <a href="{% url 'update_status_pengiriman' pengiriman.id %}" 
                                       class="btn btn-primary" title="Update Status">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    {% if pengiriman.transaksi %}
                                        <a href="{% url 'detail_transaksi' pengiriman.transaksi.id %}" 
                                           class="btn btn-info" title="Lihat Transaksi">
                                            <i class="fas fa-receipt"></i>
                                        </a>
                                    {% endif %}
                                    <a href="/admin/ecommerce/pengiriman/{{ pengiriman.id }}/change/" 
                                       class="btn btn-secondary" title="Edit di Admin">
                                        <i class="fas fa-cog"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="8" class="text-center">
                                <div class="py-4">
                                    <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                                    <p class="text-muted">Tidak ada data pengiriman</p>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if pengiriman_list.has_other_pages %}
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if pengiriman_list.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if selected_status %}&status={{ selected_status }}{% endif %}{% if selected_ekspedisi %}&ekspedisi={{ selected_ekspedisi }}{% endif %}">
                                <i class="fas fa-angle-double-left"></i> First
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ pengiriman_list.previous_page_number }}{% if selected_status %}&status={{ selected_status }}{% endif %}{% if selected_ekspedisi %}&ekspedisi={{ selected_ekspedisi }}{% endif %}">
                                <i class="fas fa-angle-left"></i> Previous
                            </a>
                        </li>
                    {% endif %}
                    
                    <!-- Page Numbers -->
                    {% for num in pengiriman_list.paginator.page_range %}
                        {% if pengiriman_list.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% elif num > pengiriman_list.number|add:'-3' and num < pengiriman_list.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}{% if selected_status %}&status={{ selected_status }}{% endif %}{% if selected_ekspedisi %}&ekspedisi={{ selected_ekspedisi }}{% endif %}">
                                    {{ num }}
                                </a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if pengiriman_list.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ pengiriman_list.next_page_number }}{% if selected_status %}&status={{ selected_status }}{% endif %}{% if selected_ekspedisi %}&ekspedisi={{ selected_ekspedisi }}{% endif %}">
                                Next <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ pengiriman_list.paginator.num_pages }}{% if selected_status %}&status={{ selected_status }}{% endif %}{% if selected_ekspedisi %}&ekspedisi={{ selected_ekspedisi }}{% endif %}">
                                Last <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <div class="d-grid">
                    <a href="/admin/ecommerce/pengiriman/add/" class="btn btn-success">
                        <i class="fas fa-plus"></i> Tambah Pengiriman Manual
                    </a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="d-grid">
                    <button class="btn btn-info" onclick="exportData()">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>
            </div>
            <div class="col-md-4">
                <div class="d-grid">
                    <button class="btn btn-warning" onclick="printLabels()">
                        <i class="fas fa-print"></i> Print Label
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto refresh every 30 seconds for real-time updates
setTimeout(function() {
    if (!document.hidden) {
        location.reload();
    }
}, 30000);

// Export functionality (placeholder)
function exportData() {
    alert('Fitur export akan segera tersedia');
}

// Print labels (placeholder)
function printLabels() {
    const selectedItems = document.querySelectorAll('input[name="selected"]:checked');
    if (selectedItems.length === 0) {
        alert('Pilih pengiriman yang ingin dicetak labelnya');
        return;
    }
    alert('Fitur print label akan segera tersedia');
}

// Add checkbox functionality if needed
document.addEventListener('DOMContentLoaded', function() {
    // Add tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });
});
</script>

<style>
.table td {
    vertical-align: middle;
}

.badge {
    font-size: 0.875rem;
}

.btn-group-sm .btn {
    padding: 0.25rem 0.5rem;
}

code {
    background-color: #f8f9fa;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 0.875rem;
}

.card:hover {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
</style>
{% endblock %}